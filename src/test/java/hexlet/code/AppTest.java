/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package hexlet.code;

import java.util.Map;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.charset.StandardCharsets;

import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.assertEquals;

import com.fasterxml.jackson.databind.ObjectMapper;

import hexlet.code.parser.ParserFactory;

class AppTest {
    @Test void getDataTest() throws Exception {
        ObjectMapper objectMapper = new ObjectMapper();
        String content = "src/test/resources/test.json";
        Path p = Paths.get(content);
        Path p1 = Paths.get("src/test/resources");
        Map<String, Object> testMap =  Map.of("name", "Jeff", "age", 22, "hobby", "programming");
        if (Files.notExists(p1)) {
            Files.createDirectories(p1);
        }
        if (Files.notExists(p)) {
            Files.createFile(p);
        }
        var data = objectMapper.writeValueAsBytes(testMap);
        Files.write(p, data);
        var actual = new ParserFactory().createParser(content).getData();

        assertEquals("Jeff", actual.get("name"));
        assertEquals(22, actual.get("age"));
        assertEquals("programming", actual.get("hobby"));
    }

    @Test void generateTest() throws Exception {
        String filepath1 = "src/test/resources/file1.json";
        String filepath2 = "src/test/resources/file2.json";
        String testFile = "src/test/resources/testFile";

        String expected = new String(Files.readAllBytes(Paths.get(testFile)), StandardCharsets.UTF_8);
        assertEquals(expected, Differ.generate(filepath1, filepath2, "stylish"));
    }

    @Test void generatePlainTest() throws Exception {
        String filepath1 = "src/test/resources/file1.yaml";
        String filepath2 = "src/test/resources/file2.yaml";
        String testFile = "src/test/resources/testFilePlain";

        String expected = new String(Files.readAllBytes(Paths.get(testFile)), StandardCharsets.UTF_8);
        assertEquals(expected, Differ.generate(filepath1, filepath2, "plain"));
    }
}
